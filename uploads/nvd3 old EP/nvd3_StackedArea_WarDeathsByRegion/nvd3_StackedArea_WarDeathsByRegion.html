<!DOCTYPE html>
<meta charset="utf-8">

<link href="nv.d3.css" rel="stylesheet" type="text/css">
<link href="../../maxstyle_for_d3/max.nv.d3.css" rel="stylesheet" type="text/css">

<style>

body {
  overflow-y:hidden;
  overflow-x:hidden;
  margin:0px 4px 0px 0px; /* new & important */
}


#CreditsContainer{
    position: absolute;

    height: 40px;
	background-color: #FAFAFA;
	width:100%;
	bottom:0;
	margin:0;
	border:0;
	padding:0;
	
}

#chart1, #chart2 {
    position: absolute;
 /* border: 2px solid #FAFAFA; */

}


#chart1 .nv-lineChart circle.nv-point,
#chart2 .nv-lineChart circle.nv-point {

    fill-opacity: 0.9;   /* Only lines: 0 – with markers: 0.9 */
}

#chart1 .nv-lineChart path.nv-line,
#chart2 .nv-lineChart path.nv-line {

    stroke-opacity: 0.6; /* Only lines: 1px – with markers: 0.6px */
    stroke-width: 0.5px; /* Only lines: 1.3px – with markers: 0.5px */
}

.tick line {
  opacity: 0.3;
}




</style>
<body>

    
  <div>
    <svg id="chart1"></svg>
  </div>

  <div>
    <svg id="CreditsContainer"></svg>
  </div>


<script src="d3.v3.js"></script>
<script src="nv.d3.js"></script>

<script>


var histcatexplong = [


{"key" : "Sub-Saharan Africa" ,
"values" :

[
  [-7.25809E+11,9566  ],
  [-6.94252E+11,0  ],
  [-6.62695E+11,0  ],
  [-6.31138E+11,0  ],
  [-5.99581E+11,0  ],
  [-5.68024E+11,2591  ],
  [-5.36467E+11,2591  ],
  [-5.0491E+11,2591  ],
  [-4.73354E+11,2591  ],
  [-4.41797E+11,2591  ],
  [-4.1024E+11,4038  ],
  [-3.78683E+11,4038  ],
  [-3.47126E+11,3900  ],
  [-3.15569E+11,116860  ],
  [-2.84012E+11,121657  ],
  [-2.52455E+11,6234  ],
  [-2.20898E+11,10256  ],
  [-1.89341E+11,22436  ],
  [-1.57785E+11,22042  ],
  [-1.26228E+11,21135  ],
  [-94670700000,36413  ],
  [-63113800000,50173  ],
  [-31556900000,50122  ],
  [0,23510  ],
  [31556900000,21316  ],
  [63113800000,22168  ],
  [94670700000,17748  ],
  [1.26228E+11,19686  ],
  [1.57785E+11,18402  ],
  [1.89341E+11,29837  ],
  [2.20898E+11,32138  ],
  [2.52455E+11,41443  ],
  [2.84012E+11,32265  ],
  [3.15569E+11,36267  ],
  [3.47126E+11,42445  ],
  [3.78683E+11,42058  ],
  [4.1024E+11,47510  ],
  [4.41797E+11,66320  ],
  [4.73354E+11,64827  ],
  [5.0491E+11,67510  ],
  [5.36467E+11,62196  ],
  [5.68024E+11,39326  ],
  [5.99581E+11,38522  ],
  [6.31138E+11,53807  ],
  [6.62695E+11,52389  ],
  [6.94252E+11,23760  ],
  [7.25809E+11,27992  ],
  [7.57366E+11,28499  ],
  [7.88923E+11,6003  ],
  [8.20479E+11,10036  ],
  [8.52036E+11,16306  ],
  [8.83593E+11,65168  ],
  [9.1515E+11,95458  ],
  [9.46707E+11,55555  ],
  [9.78264E+11,44767  ],
  [1.00982E+12,6389  ],
  [1.04138E+12,5409  ],
  [1.07293E+12,5550  ],
  [1.10449E+12,1289  ],
  [1.13605E+12,3292  ],
  [1.16761E+12,2718  ]
]

},

{"key" : "Americas" ,
"values" :
[
  [-7.25809E+11,4000  ],
  [-6.94252E+11,2000  ],
  [-6.62695E+11,40  ],
  [-6.31138E+11,34  ],
  [-5.99581E+11,0  ],
  [-5.68024E+11,1725  ],
  [-5.36467E+11,28  ],
  [-5.0491E+11,78  ],
  [-4.73354E+11,850  ],
  [-4.41797E+11,983  ],
  [-4.1024E+11,1023  ],
  [-3.78683E+11,984  ],
  [-3.47126E+11,0  ],
  [-3.15569E+11,0  ],
  [-2.84012E+11,824  ],
  [-2.52455E+11,400  ],
  [-2.20898E+11,25  ],
  [-1.89341E+11,230  ],
  [-1.57785E+11,4665  ],
  [-1.26228E+11,400  ],
  [-94670700000,502  ],
  [-63113800000,1010  ],
  [-31556900000,3797  ],
  [0,1720  ],
  [31556900000,1650  ],
  [63113800000,2061  ],
  [94670700000,3395  ],
  [1.26228E+11,2575  ],
  [1.57785E+11,2040  ],
  [1.89341E+11,2580  ],
  [2.20898E+11,1717  ],
  [2.52455E+11,4300  ],
  [2.84012E+11,9570  ],
  [3.15569E+11,3599  ],
  [3.47126E+11,19541  ],
  [3.78683E+11,14838  ],
  [4.1024E+11,16913  ],
  [4.41797E+11,16898  ],
  [4.73354E+11,13168  ],
  [5.0491E+11,11638  ],
  [5.36467E+11,11419  ],
  [5.68024E+11,6798  ],
  [5.99581E+11,11186  ],
  [6.31138E+11,5084  ],
  [6.62695E+11,4387  ],
  [6.94252E+11,4291  ],
  [7.25809E+11,2441  ],
  [7.57366E+11,1668  ],
  [7.88923E+11,1855  ],
  [8.20479E+11,1337  ],
  [8.52036E+11,1280  ],
  [8.83593E+11,1504  ],
  [9.1515E+11,1380  ],
  [9.46707E+11,1469  ],
  [9.78264E+11,13840  ],
  [1.00982E+12,1910  ],
  [1.04138E+12,500  ],
  [1.07293E+12,1798  ],
  [1.10449E+12,1489  ],
  [1.13605E+12,693  ],
  [1.16761E+12,502  ]
]
},
{"key" : "Central & South Asia" ,
"values" :
[
  [-7.25809E+11,5500  ],
  [-6.94252E+11,20860  ],
  [-6.62695E+11,5500  ],
  [-6.31138E+11,5500  ],
  [-5.99581E+11,5500  ],
  [-5.68024E+11,0  ],
  [-5.36467E+11,0  ],
  [-5.0491E+11,0  ],
  [-4.73354E+11,0  ],
  [-4.41797E+11,781  ],
  [-4.1024E+11,781  ],
  [-3.78683E+11,739  ],
  [-3.47126E+11,512  ],
  [-3.15569E+11,25  ],
  [-2.84012E+11,659  ],
  [-2.52455E+11,627  ],
  [-2.20898E+11,512  ],
  [-1.89341E+11,763  ],
  [-1.57785E+11,5512  ],
  [-1.26228E+11,1066  ],
  [-94670700000,1010  ],
  [-63113800000,1100  ],
  [-31556900000,82  ],
  [0,82  ],
  [31556900000,162566  ],
  [63113800000,0  ],
  [94670700000,0  ],
  [1.26228E+11,2150  ],
  [1.57785E+11,2221  ],
  [1.89341E+11,2221  ],
  [2.20898E+11,2221  ],
  [2.52455E+11,15583  ],
  [2.84012E+11,30692  ],
  [3.15569E+11,36584  ],
  [3.47126E+11,30196  ],
  [3.78683E+11,35708  ],
  [4.1024E+11,55873  ],
  [4.41797E+11,83982  ],
  [4.73354E+11,67449  ],
  [5.0491E+11,63012  ],
  [5.36467E+11,49142  ],
  [5.68024E+11,36141  ],
  [5.99581E+11,23302  ],
  [6.31138E+11,22644  ],
  [6.62695E+11,24637  ],
  [6.94252E+11,36867  ],
  [7.25809E+11,40050  ],
  [7.57366E+11,22369  ],
  [7.88923E+11,16049  ],
  [8.20479E+11,13273  ],
  [8.52036E+11,11535  ],
  [8.83593E+11,16304  ],
  [9.1515E+11,14918  ],
  [9.46707E+11,16511  ],
  [9.78264E+11,10140  ],
  [1.00982E+12,6080  ],
  [1.04138E+12,3556  ],
  [1.07293E+12,4003  ],
  [1.10449E+12,3907  ],
  [1.13605E+12,7095  ],
  [1.16761E+12,9538  ]
]

},


{"key" : "East & South East Asia & Oceania" ,
"values" :[
  [-7.25809E+11,347585  ],
  [-6.94252E+11,397798  ],
  [-6.62695E+11,419178  ],
  [-6.31138E+11,589784  ],
  [-5.99581E+11,399101  ],
  [-5.68024E+11,149484  ],
  [-5.36467E+11,99871  ],
  [-5.0491E+11,48620  ],
  [-4.73354E+11,10049  ],
  [-4.41797E+11,12371  ],
  [-4.1024E+11,8772  ],
  [-3.78683E+11,23308  ],
  [-3.47126E+11,28553  ],
  [-3.15569E+11,16543  ],
  [-2.84012E+11,21505  ],
  [-2.52455E+11,44811  ],
  [-2.20898E+11,63796  ],
  [-1.89341E+11,58452  ],
  [-1.57785E+11,84835  ],
  [-1.26228E+11,91281  ],
  [-94670700000,102227  ],
  [-63113800000,204274  ],
  [-31556900000,164113  ],
  [0,205387  ],
  [31556900000,193187  ],
  [63113800000,294574  ],
  [94670700000,208596  ],
  [1.26228E+11,239662  ],
  [1.57785E+11,110702  ],
  [1.89341E+11,22285  ],
  [2.20898E+11,22565  ],
  [2.52455E+11,53969  ],
  [2.84012E+11,90547  ],
  [3.15569E+11,20268  ],
  [3.47126E+11,21227  ],
  [3.78683E+11,20439  ],
  [4.1024E+11,19993  ],
  [4.41797E+11,20368  ],
  [4.73354E+11,19868  ],
  [5.0491E+11,20495  ],
  [5.36467E+11,16448  ],
  [5.68024E+11,16241  ],
  [5.99581E+11,3163  ],
  [6.31138E+11,5003  ],
  [6.62695E+11,5188  ],
  [6.94252E+11,9978  ],
  [7.25809E+11,1519  ],
  [7.57366E+11,6787  ],
  [7.88923E+11,1249  ],
  [8.20479E+11,1293  ],
  [8.52036E+11,1440  ],
  [8.83593E+11,1666  ],
  [9.1515E+11,1482  ],
  [9.46707E+11,1742  ],
  [9.78264E+11,1859  ],
  [1.00982E+12,960  ],
  [1.04138E+12,1636  ],
  [1.07293E+12,1236  ],
  [1.10449E+12,941  ],
  [1.13605E+12,728  ],
  [1.16761E+12,720  ]
]
	
},

{

"key" : "Europe" ,
"values" :[
  [-7.25809E+11,48684  ],
  [-6.94252E+11,42849  ],
  [-6.62695E+11,39012  ],
  [-6.31138E+11,512  ],
  [-5.99581E+11,0  ],
  [-5.68024E+11,0  ],
  [-5.36467E+11,0  ],
  [-5.0491E+11,0  ],
  [-4.73354E+11,96  ],
  [-4.41797E+11,3267  ],
  [-4.1024E+11,97  ],
  [-3.78683E+11,97  ],
  [-3.47126E+11,97  ],
  [-3.15569E+11,0  ],
  [-2.84012E+11,1180  ],
  [-2.52455E+11,1180  ],
  [-2.20898E+11,0  ],
  [-1.89341E+11,0  ],
  [-1.57785E+11,0  ],
  [-1.26228E+11,0  ],
  [-94670700000,0  ],
  [-63113800000,0  ],
  [-31556900000,0  ],
  [0,0  ],
  [31556900000,171  ],
  [63113800000,479  ],
  [94670700000,253  ],
  [1.26228E+11,294  ],
  [1.57785E+11,260  ],
  [1.89341E+11,295  ],
  [2.20898E+11,111  ],
  [2.52455E+11,81  ],
  [2.84012E+11,121  ],
  [3.15569E+11,171  ],
  [3.47126E+11,143  ],
  [3.78683E+11,1074  ],
  [4.1024E+11,85  ],
  [4.41797E+11,69  ],
  [4.73354E+11,57  ],
  [5.0491E+11,61  ],
  [5.36467E+11,150  ],
  [5.68024E+11,104  ],
  [5.99581E+11,984  ],
  [6.31138E+11,501  ],
  [6.62695E+11,4455  ],
  [6.94252E+11,19776  ],
  [7.25809E+11,23505  ],
  [7.57366E+11,11524  ],
  [7.88923E+11,32062  ],
  [8.20479E+11,16000  ],
  [8.52036E+11,0  ],
  [8.83593E+11,1055  ],
  [9.1515E+11,18100  ],
  [9.46707E+11,14500  ],
  [9.78264E+11,5122  ],
  [1.00982E+12,753  ],
  [1.04138E+12,480  ],
  [1.07293E+12,1151  ],
  [1.10449E+12,668  ],
  [1.13605E+12,259  ],
  [1.16761E+12,174  ]
]
},
{

"key" : "Middle East & North Africa" ,
"values" : [
  [-7.25809E+11,0  ],
  [-6.94252E+11,23792  ],
  [-6.62695E+11,1575  ],
  [-6.31138E+11,256  ],
  [-5.99581E+11,350  ],
  [-5.68024E+11,345  ],
  [-5.36467E+11,569  ],
  [-5.0491E+11,21699  ],
  [-4.73354E+11,21699  ],
  [-4.41797E+11,23591  ],
  [-4.1024E+11,20718  ],
  [-3.78683E+11,22624  ],
  [-3.47126E+11,22537  ],
  [-3.15569E+11,20537  ],
  [-2.84012E+11,27514  ],
  [-2.52455E+11,32332  ],
  [-2.20898E+11,12902  ],
  [-1.89341E+11,9291  ],
  [-1.57785E+11,9753  ],
  [-1.26228E+11,10641  ],
  [-94670700000,15462  ],
  [-63113800000,9678  ],
  [-31556900000,12583  ],
  [0,11756  ],
  [31556900000,520  ],
  [63113800000,696  ],
  [94670700000,12093  ],
  [1.26228E+11,15701  ],
  [1.57785E+11,19860  ],
  [1.89341E+11,64069  ],
  [2.20898E+11,2069  ],
  [2.52455E+11,2581  ],
  [2.84012E+11,6147  ],
  [3.15569E+11,45450  ],
  [3.47126E+11,103635  ],
  [3.78683E+11,155424  ],
  [4.1024E+11,111536  ],
  [4.41797E+11,80544  ],
  [4.73354E+11,76435  ],
  [5.0491E+11,88698  ],
  [5.36467E+11,71277  ],
  [5.68024E+11,168861  ],
  [5.99581E+11,8889  ],
  [6.31138E+11,9554  ],
  [6.62695E+11,62999  ],
  [6.94252E+11,6815  ],
  [7.25809E+11,8687  ],
  [7.57366E+11,17949  ],
  [7.88923E+11,20011  ],
  [8.20479E+11,14899  ],
  [8.52036E+11,15880  ],
  [8.83593E+11,14180  ],
  [9.1515E+11,2850  ],
  [9.46707E+11,2708  ],
  [9.78264E+11,3001  ],
  [1.00982E+12,773  ],
  [1.04138E+12,8786  ],
  [1.07293E+12,4408  ],
  [1.10449E+12,3123  ],
  [1.13605E+12,5211  ],
  [1.16761E+12,3121  ]
]
}

 
];


/*
.map(function(series) {
  series.values = series.values.map(function(d) {
    return { x: d[0], y: d[1] }
  });
  return series;
});
*/

//an example of harmonizing colors between visualizations
//observe that Consumer Discretionary and Consumer Staples have
//been flipped in the second chart



var colors = d3.scale.category10(); // So war es im Original

//Gleiche Farben wie in Datamaps
//var colors = d3.scale.ordinal()
//          .range(["#939393", "#d73027", "#fc8d59", "#d9ef8b", "#91cf60", "#1a9850"])
//          .domain(d3.range(0,6));
		  
		  
		  
keyColor = function(d, i) {return colors(d.key)};



  
  
  
var chart;
nv.addGraph(function() {
  chart = nv.models.stackedAreaChart()
  		.margin({top: 30, right: 20, bottom: 70, left: 85}) 

                .useInteractiveGuideline(true)
                .x(function(d) { return d[0] })
                .y(function(d) { return d[1] })
                .color(keyColor)
                .transitionDuration(100);

                //.clipEdge(true);

// chart.stacked.scatter.clipVoronoi(false);

  chart.xAxis
      .tickFormat(function(d) { return d3.time.format('%Y')(new Date(d)) });

  chart.yAxis
      .axisLabel('Number of annual war battle deaths by world region')
  	  .axisLabelDistance(15)
      .tickFormat(d3.format(',.0f'));

  d3.select('#chart1')
    .datum(histcatexplong)
    .transition().duration(1000) //Die Zeit mit der sich der Chart am Anfang aufbaut
    .call(chart)
//    .transition().duration(5000)
    .each('start', function() {
        setTimeout(function() {
            d3.selectAll('#chart1 *').each(function() {
              console.log('start',this.__transition__, this)
              // while(this.__transition__)
              if(this.__transition__)
                this.__transition__.duration = 1;
            })
          }, 0)
      })
    // .each('end', function() {
    //         d3.selectAll('#chart1 *').each(function() {
    //           console.log('end', this.__transition__, this)
    //           // while(this.__transition__)
    //           if(this.__transition__)
    //             this.__transition__.duration = 1;
    //         })});

	

  nv.utils.windowResize(chart.update);

  // chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });



  return chart;
  
  
});


var logoCanvas = d3.select("#chart1")

logoCanvas.append("svg:image")
   		.attr('x',3)
   		.attr('y',1)
   		.attr('width', 32)
   		.attr('height', 22)
   		.attr("xlink:href","../../maxstyle_for_d3/EPLogo.png");



/*--------------------------------------------------*/
/*    				  Credits    					*/
/*--------------------------------------------------*/
   		
var creditsCanvas = d3.select("#CreditsContainer")
		var xorigin=8;
		var yorigin=1;


/*1. Zeile*/	
creditsCanvas
	.append("text")
	.text("The author Max Roser licensed this visualisation under a")
	.attr("x",xorigin+0)
	.attr("y",yorigin+10)
	.attr("id",'erstesTextstuck').attr('class','creditsText');
var erstesTextstuckLange = document.getElementById('erstesTextstuck').getComputedTextLength();

creditsCanvas.append("svg:a")
		  .attr("xlink:href", "http://creativecommons.org/licenses/by-sa/4.0/deed.en_US")
		  .attr("target","_blank")
		  .append("svg:text")
		  .attr("x", xorigin+erstesTextstuckLange+3)
		  .attr("y", yorigin+10)
		  .attr('class','creditsLink').attr("id",'zweitesTextstuck')
	      .text("CC BY-SA license");
var zweitesTextstuckLange = document.getElementById('zweitesTextstuck').getComputedTextLength();


creditsCanvas
	.append("text")
	.text(". You are welcome to share but please refer to its source where you")
	.attr("x",xorigin+erstesTextstuckLange+3+zweitesTextstuckLange+1)
	.attr("y",yorigin+10)
	.attr("id",'drittesTextstuck').attr('class','creditsText');	
var drittesTextstuckLange = document.getElementById('drittesTextstuck').getComputedTextLength();

	
/*1. oder 2. Zeile*/	

var TextViertesTextstuck = creditsCanvas
	.append("text")
	.text("find more information:")
	.attr("id",'viertesTextstuck')
	.attr('class','creditsText');
	var viertesTextstuckLange = document.getElementById('viertesTextstuck').getComputedTextLength();
	
var TextFunftesTextstuck = creditsCanvas.append("svg:a")
		  .attr("xlink:href", "http://www.explainingprogress.com/data/war-peace/war-and-peace-after-1945/")
		  .attr("target","_blank")
		  .append("svg:text")
		  .attr('class','creditsLink')
	      .text("www.explainingprogress.com/data/war-peace/war-and-peace-after-1945")
		  .attr("id",'funftesTextstuck');
var funftesTextstuckLange = document.getElementById('funftesTextstuck').getComputedTextLength();

var creditsCanvasWidth = parseInt(creditsCanvas.style('width'));
var LongTextWidth = parseInt( xorigin + erstesTextstuckLange + 3 + zweitesTextstuckLange + 1 + drittesTextstuckLange + 3 + viertesTextstuckLange + 3 + funftesTextstuckLange );

if (creditsCanvasWidth > LongTextWidth ) {
TextViertesTextstuck
	.attr("x",xorigin+erstesTextstuckLange+3+zweitesTextstuckLange+1+drittesTextstuckLange+3)
	.attr("y",yorigin+10);
	}
 else
  {
TextViertesTextstuck
	.attr("x",xorigin+0)
	.attr("y",yorigin+21);
	  }

	
if (creditsCanvasWidth > LongTextWidth ) {
	TextFunftesTextstuck
		  .attr("x",xorigin+erstesTextstuckLange+3+zweitesTextstuckLange+1+drittesTextstuckLange+3+viertesTextstuckLange+3)
		  .attr("y", yorigin+10);
	}
 else
  {
TextFunftesTextstuck
		  .attr("x", xorigin+102)
		  .attr("y", yorigin+21);
	  }



/*3. Zeile*/	
creditsCanvas
  	.append("text")
  	.text("Data sources: Human Security Project (PRIO data)")
  	.attr("x",xorigin+0)
  	.attr("y",yorigin+32)
  	.attr('class','creditsText');
	
/* ------- end credits ------ */
		  
		  


</script>
